<!doctype html>
<html>

<head>
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
	<title>CANVAS-爱心特效</title>
</head>
<style>
	html,
	body,
	canvas {
		margin: 0;
		padding: 9;
	}

	html,
	body {
		width: 100%;
		height: 100%;
	}

	body {
		overflow: hidden;
	}

	.blur {
		filter: blur(1px);
	}
</style>

<body bgcolor="#000000">
	<canvas id="canvas"></canvas>
</body>
<script>
	var canvas = document.getElementById("canvas")
	canvas.style.position = "absolute"
	canvas.style.top = 0
	var w = window.innerWidth
	var h = window.innerHeight
	canvas.width = w
	canvas.height = h
	ctx = canvas.getContext("2d")
	ctx.translate(w / 2, h / 2)
	var sin = Math.sin, cos = Math.cos, random = Math.random, PI = Math.PI, min = Math.min

	var fillStyle = {
		r: 200,
		g: ~~(200 * random()),
		b: ~~(200 * random())
	}

	var scale = 9 // 图形放大倍数
	var x, y
	var deg = PI
	var list = []

	function createStar(x, y) {
		var count = 10
		for (var i = 0; i < count; i++) {
			var deg = PI * 2 * random()
			var sx = cos(deg) * random() * 0.4
			var sy = sin(deg) * random() * 0.4
			var len = 20 + random() * 130
			var r = random() * 2.1
			var color = {
				r: fillStyle.r + ~~(random() * 55),
				g: fillStyle.g + ~~(random() * 55),
				b: fillStyle.b + ~~(random() * 55),
			}
			list.push({ x, y, sx, sy, len, r, color })
		}
	}

	function update() {
		if (deg > 0) {
			deg -= 0.025
			x = scale * (16 * sin(deg) * sin(deg) * sin(deg))
			y = scale * (13 * cos(deg) - 5 * cos(2 * deg) - 2 * cos(3 * deg) - cos(4 * deg))
			createStar(x, -y)
			createStar(-x, -y)
		}
		list.forEach(item => {
			item.x += item.sx
			item.y += item.sy
			if (deg <= 0) { // 如果心已经画完，这些点就逐渐消失
				item.len -= 1
			}
		})
		list = list.filter(item => item.len > 0)
	}

	function draw() {
		ctx.clearRect(-w / 2, -h / 2, w, h)
		list.forEach(function (item) {
			ctx.beginPath()
			ctx.arc(item.x, item.y, item.r, 0, PI * 2)
			ctx.fillStyle = 'rgba(' + item.color.r + ',' + item.color.g + ',' + item.color.b + ',' + min(1, item.len / 40) + ')'
			ctx.fill()
		})
	}

	function step() {
		update()
		draw()
		if (list.length === 0) {
			setTimeout(function () {
				// 重新开始下一个心
				deg = PI
				fillStyle = {
					r: 200,
					g: ~~(200 * random()),
					b: ~~(200 * random())
				}
				step()
			}, 500)
		} else {
			requestAnimationFrame(step)
		}
	}
	requestAnimationFrame(step)

</script>

</html>