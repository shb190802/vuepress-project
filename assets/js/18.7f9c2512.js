(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{508:function(v,_,l){"use strict";l.r(_);var i=l(4),t=Object(i.a)({},(function(){var v=this,_=v.$createElement,l=v._self._c||_;return l("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("table",[l("thead",[l("tr",[l("th",[v._v("开发时间")]),v._v(" "),l("th",[v._v("前端开发者")]),v._v(" "),l("th",[v._v("提交次数")])])]),v._v(" "),l("tbody",[l("tr",[l("td",[v._v("2019年08月06日-2019年10月31日")]),v._v(" "),l("td",[v._v("索洪波、卢玺、张亚亚、王威、宋伟（特别开发：李彬）")]),v._v(" "),l("td",[v._v("1381")])])])]),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("h2",{attrs:{id:"前期准备"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[v._v("#")]),v._v(" 前期准备")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("技术选型")])]),v._v(" "),l("ul",[l("li",[v._v("物业端（Vue + iview-admin）")]),v._v(" "),l("li",[v._v("业主端（Vue + vant-ui）")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("制定开发规范")])]),v._v(" "),l("ul",[l("li",[v._v("开发规范地址："),l("a",{attrs:{href:"https://shb190802.github.io/front-end-dev-guide/dist/",target:"_blank",rel:"noopener noreferrer"}},[v._v("https://shb190802.github.io/front-end-dev-guide/dist/"),l("OutboundLink")],1)])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用VSCode")])]),v._v(" "),l("ul",[l("li",[v._v("安装eslint、Prettier、Vetur等插件做代码检测和格式化")]),v._v(" "),l("li",[v._v("配置vscode的setting.json")]),v._v(" "),l("li",[v._v("设置统一的代码格式化风格")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("代码质量管理")])]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("做好需求分析")])]),v._v(" "),l("p",[v._v("从收到产品提出的需求之后，先做初步整理。然后和相关人员（提出需求的业务、前后端开发者、测试人员等）进行讨论定稿。保证需求、设计、开发统一")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用GIT管理代码")])]),v._v(" "),l("ol",[l("li",[v._v("master、test、dev分支做代码保护，仅支持发起合并请求")]),v._v(" "),l("li",[v._v("根据teambtion上的任务ID作为分支名，对应开发者")]),v._v(" "),l("li",[v._v("功能完成之后发起合并")]),v._v(" "),l("li",[v._v("小步提交")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("每日代码评审")])]),v._v(" "),l("p",[v._v("每日下班前，小组抽出30分钟左右对代码进行评审。主要是：")]),v._v(" "),l("ol",[l("li",[v._v("同步大家工作进度")]),v._v(" "),l("li",[v._v("一起分析遇到的棘手问题")]),v._v(" "),l("li",[v._v("对可重复利用方法和功能进行封装")]),v._v(" "),l("li",[v._v("分享今日心得")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("编写测试代码")])]),v._v(" "),l("p",[v._v("由于项目紧急，此项功能没有执行")])])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("其他技术选型")])]),v._v(" "),l("ol",[l("li",[v._v("地图组件（考虑到业主端在微信公众号中使用，地图选择腾讯地图）")]),v._v(" "),l("li",[v._v("富文本组件（使用quillEditor）\n"),l("ul",[l("li",[v._v("markdown编辑器：优势：轻量级；劣势：功能过于简单")]),v._v(" "),l("li",[v._v("tinymce ：功能强大的编辑器。前期一直使用；测试时候发现，编译之后尺寸太大。弃用")]),v._v(" "),l("li",[v._v("quillEditor： 功能丰富，尺寸适中")])])]),v._v(" "),l("li",[v._v("打印组件（lodop，功能强大且支持打印设计）")])])])]),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("h2",{attrs:{id:"开发中"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#开发中"}},[v._v("#")]),v._v(" 开发中")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("路由懒加载")])]),v._v(" "),l("p",[v._v("为保证首屏加载速度。所有的路由必须使用懒加载")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("组件设计原则")])]),v._v(" "),l("ol",[l("li",[v._v("低耦合、高内聚")]),v._v(" "),l("li",[v._v("公共组件\n"),l("ul",[l("li",[v._v("与业务无关性")]),v._v(" "),l("li",[v._v("要有良好的独立性，单一职责")]),v._v(" "),l("li",[v._v("放在在src/components目录下")]),v._v(" "),l("li",[v._v("组件以zy-开头（例：zy-editor）")])])]),v._v(" "),l("li",[v._v("业务组件\n"),l("ul",[l("li",[v._v("就近存放在使用目录下")]),v._v(" "),l("li",[v._v("入口清晰，引用方便")])])]),v._v(" "),l("li",[v._v("大驼峰命名（参照开发规范）")])])])]),v._v(" "),l("ol",{attrs:{start:"5"}},[l("li",[v._v("所有组件顶部声明组件功能及说明")])]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("安全管理")])]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("通讯数据加密")])]),v._v(" "),l("p",[v._v("数据加密是模拟https的流程，实现前后的通讯加密处理")]),v._v(" "),l("ol",[l("li",[v._v("客户端生成RSA的公钥和私钥")]),v._v(" "),l("li",[v._v("将公钥发给服务端")]),v._v(" "),l("li",[v._v("服务端生成AES秘钥，使用客户端发送过来的公钥加密后返回给客户端")]),v._v(" "),l("li",[v._v("之后的前后的通讯都使用AES秘钥进行加解密")]),v._v(" "),l("li",[v._v("请求体加入时间戳混淆，防止重复提交")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("权限管理")])]),v._v(" "),l("p",[v._v("对于用户可访问的页面级按钮做到权限管理")]),v._v(" "),l("ol",[l("li",[v._v("后端在用户登录时候，缓存用户拥有的权限，并将对应权限返回给客户端")]),v._v(" "),l("li",[v._v("客户端根据用户不同身份和权限，控制对应页面和按钮的显示隐藏")]),v._v(" "),l("li",[v._v("接口请求期间，带上该按钮对应的按钮ID，服务端二次判断用户是否有该接口的权限")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("预防XSS攻击")])]),v._v(" "),l("p",[v._v("引用第三方xss库对富文本等使用到的文本进行xss过滤")])])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("vuex使用")])]),v._v(" "),l("ol",[l("li",[v._v("对应后台消耗较大，前端一次请求基本不变或者变动较少内容，需存入store中（如：常用字典值、省市县信息、物业小区信息等）")]),v._v(" "),l("li",[v._v("所有存入store中数据的接口请求，必须使用action")]),v._v(" "),l("li",[v._v("必须使用mapGetters、mapMutations、mapActions")]),v._v(" "),l("li",[v._v("mutation必须全部大写")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("全局主题配置")])]),v._v(" "),l("p",[v._v("项目中使用less做css预处理，主色、标题、背景、等主题颜色在设置和引用时候，必须使用全局变量")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("全局config")])]),v._v(" "),l("p",[v._v("在config文件中配置一些全局配置。如：")]),v._v(" "),l("ol",[l("li",[v._v("baseUrl")]),v._v(" "),l("li",[v._v("文件服务器地址")]),v._v(" "),l("li",[v._v("全局正则校验")]),v._v(" "),l("li",[v._v("全局错误提示")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("全局utils")])]),v._v(" "),l("ol",[l("li",[v._v("常用util挂在在Vue原型上")]),v._v(" "),l("li",[v._v("不常用util单独引用")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("合作开发")])]),v._v(" "),l("ol",[l("li",[l("p",[v._v("代理服务器配置")]),v._v(" "),l("p",[v._v("由于项目前后端属于多人开发，在联调过程中。需要配置不同接口的不同代理服务地址")]),v._v(" "),l("ul",[l("li",[v._v("增加vue.config.local.js文件，并设置git.ignore")]),v._v(" "),l("li",[v._v("vue.config.js中引用local文件，并将配置以local为基准合并")]),v._v(" "),l("li",[v._v("个人开发期间使用的相关配置写在vue.config.local.js中")])])]),v._v(" "),l("li",[l("p",[v._v("接口模式")]),v._v(" "),l("p",[v._v("由于项目牵扯到登录、加解密、权限管理功能模块。前端增加对应的开发模式设置")]),v._v(" "),l("ol",[l("li",[v._v("nocrypt：请求和响应不加解密")]),v._v(" "),l("li",[v._v("nologin：请求和响应不传用户身份用户身份")]),v._v(" "),l("li",[v._v("nofilter：页面不会根据权限过滤菜单和按钮")])])])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("数据mock")])]),v._v(" "),l("p",[v._v("在拿到开发需求之后，前后端需要整理出完成功能所需的api接口。\n前端静态页面开发完成，后端代码短期无法完成时候，前端需要独立mock数据，完成所有逻辑。等待后端开发完之后，直接联调。")]),v._v(" "),l("ol",[l("li",[v._v("使用koa搭建mock服务器，配合koa-router和koa-body来解析请求地址和请求体")]),v._v(" "),l("li",[v._v("使用mockjs，模拟返回值")]),v._v(" "),l("li",[v._v("修改mock服务端response.status，模拟各种异常情况")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("axios封装")])]),v._v(" "),l("p",[v._v("由于项目中使用的加解密等各种情况，为了不让每个开发者编写很多重复代码。对axios做了一些封装。")]),v._v(" "),l("ol",[l("li",[v._v("加解密流程封装在拦截器里")]),v._v(" "),l("li",[v._v("拦截器中请求体混入时间戳")]),v._v(" "),l("li",[v._v("封装基础的公共配置（如：header等）")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("添加loading")])]),v._v(" "),l("p",[v._v("所有与后端的交互，除非场景要求静默，否则必须加上loading效果")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用filter")])]),v._v(" "),l("p",[v._v("开发中使用到很多字典值比如：支付方式、性别等。使用全局filter来显示对应文本内容")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用mixin")])]),v._v(" "),l("p",[v._v("相似的页面会存在大量的共同代码，使用mixin能很好的减少代码量和修改难度")])])]),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("h2",{attrs:{id:"优化"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[v._v("#")]),v._v(" 优化")]),v._v(" "),l("p",[v._v("开发期间，对整体项目进行了一些优化。")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("使用webpack-bundle-analyzer")])]),v._v(" "),l("p",[v._v("使用webpack的webpack-bundle-analyzer插件，对项目所引用的外部组件进行优化。去掉体积很大，但是功能使用不多的第三方库。（tinymce就是再此步骤被优化）")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("适配多分辨率")])]),v._v(" "),l("p",[v._v("设计师给出的设计图，移动端为414px、PC端为1920。我们需要将其适配多个尺寸。")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("移动端")])]),v._v(" "),l("p",[v._v("使用postcss-pxtorem插件，在构建时候，会将px值修改为rem")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("PC端")])]),v._v(" "),l("p",[v._v("PC端没有使用pxtorem。使用先放大后缩放的设计。具体思路都是，将body的宽度设置为1920，然后在对根据网页宽度做缩放。")]),v._v(" "),l("ol",[l("li",[v._v("使用tranfrom")]),v._v(" "),l("li",[v._v("使用zoom （由于zoom具有更好的兼容性。本项目使用zoom）")])])])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("图片压缩")])]),v._v(" "),l("p",[v._v("真的背景等大图片。使用图片压缩。")]),v._v(" "),l("ol",[l("li",[v._v("使用png-8 替换 png-32/24")]),v._v(" "),l("li",[v._v("照片类使用jpeg格式并压低质量")]),v._v(" "),l("li",[v._v("微信端的图片上上传，使用微信图片压缩功能")]),v._v(" "),l("li",[v._v("webp由于兼容性问题，暂时不作考虑")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("去掉preload、prefetch")])]),v._v(" "),l("p",[v._v("preload和prefetch会在浏览器空闲时间，静默下载其他首页未引用静态资源。增加之后页面的访问体验"),l("br"),v._v("\n但是静默下载默认会消耗服务端带宽，造成服务器出口带宽压力。此处删除")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("去掉lodash")])]),v._v(" "),l("p",[v._v("lodash库功能强大，不过客户端仅使用其中很少一部分代码。所以替换使用的工具库，删除lodash")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用echarts.simple 代替权利echarts")])]),v._v(" "),l("p",[v._v("由于我们使用echarts仅仅基础内容，所有引用/echarts/echarts.simple完全满足，单独需求可以自定义引用。")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("引用moment.min代替直接引用moment")])]),v._v(" "),l("p",[v._v("moment默认自带了国际化，此处不需要。手动修改引用指向/moment/min/moment.min")]),v._v(" "),l("ul",[l("li",[v._v("编译报warn 可以手动在node_modules/moment/min里边新增locale文件夹来取消，不影响使用")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用webpack.DllPlugin来剥离公共库")])]),v._v(" "),l("p",[v._v("将公共库组件剥离出来，加速编译。")]),v._v(" "),l("p",[v._v("此处优化作用不是特别明显，暂时放弃。")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用happypack加速编译速度")])]),v._v(" "),l("p",[v._v("开发环境正常启动，但是build时报错，官方也没有反馈issue。暂时放弃")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("添加项目编译时间")])]),v._v(" "),l("p",[v._v("每次build的时候，给项目增加一个当前编译时间。来确定项目是什么时候变异的版本。")])])]),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("h2",{attrs:{id:"上线"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#上线"}},[v._v("#")]),v._v(" 上线")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("设置编译模式（env）")])]),v._v(" "),l("p",[v._v("根据不同的生产环境，设置不同的编译模式，不同的编译模式下可以使用不同的请求方式（如：baseUrl，加解密方式等）")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("Jenkins自动发布")])]),v._v(" "),l("p",[v._v("配置Jenkins服务器，自动编译上传最新代码")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("开启gzip")])]),v._v(" "),l("ol",[l("li",[v._v("服务端针对js、css文件开启gzip压缩功能，但是开启压缩功能会导致服务器内向消耗。")]),v._v(" "),l("li",[v._v("客户端代码在打包时候，针对js、css文件，使用compression-webpack-plugin打包出一份.gz后缀的文件，服务端配置如果存在对应的gz文件。则不再做压缩操作。直接返回gz文件")])])])]),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("br"),v._v(" "),l("h3",{attrs:{id:"开发中的一些小分享"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#开发中的一些小分享"}},[v._v("#")]),v._v(" 开发中的一些小分享")]),v._v(" "),l("ul",[l("li",[l("p",[l("strong",[v._v("loading的“点点点”效果（如：进行中。。。）")])]),v._v(" "),l("p",[v._v("经常遇到加载中需要文字后边点点点一直变化的功能。这里使用增加一个类，给类的伪元素加上动画效果。分别在25% 50% 75%处，修改伪元素的content为 。  。。 。。。")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("大数组合并")])]),v._v(" "),l("p",[v._v("前端缓存了很多请求数据。如：（楼栋房间信息）。之后的接口请求到每个房间的住户、仪表、账单等信息时候。需要将其合并入房间信息的缓存数据中。"),l("br"),v._v("\n此时，可以将住户、仪表、账单等转换为以houseId为主键的Object。然后遍历房间信息合并这个Object")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("数据扁平化")])]),v._v(" "),l("p",[v._v("因为房间数据是一颗树节点的格式（楼栋-单元-楼层-房间）这样如果要单独修改一个房间的数据。则需要很多次的遍历。"),l("br"),v._v("\n此时，将楼栋、单元、楼层、房间分别缓存一个以其ID为主键的Object。直接使用Object[key]来使用")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("去除生产版本console")])]),v._v(" "),l("p",[v._v("开发中会大量使用的console来打印日志，业务上线后需要出去掉这些。两个思路：")]),v._v(" "),l("ol",[l("li",[v._v("开发时候就约定好。将console的方法做好封装。")]),v._v(" "),l("li",[v._v("上线版本，重写一下console相关方法（本项目使用此方法）")])])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("使用keepalive.include")])]),v._v(" "),l("p",[v._v("keepalive在vue开发中，被我们大量使用到。但是为了防止不必要的缓存。我们使用include方法。"),l("br"),v._v("\n实时监听当前显示的tag标签。将路由的name合并为数组赋值给include。这样保证关闭标签后会释放缓存、切换标签时候保留缓存。"),l("br"),v._v("\n页面组件的name必须和route的name保持一致")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("浏览器针对input.password默认事件")])]),v._v(" "),l("p",[v._v("浏览器会根据根对类型为password的input标签，默认选择已保存密码。"),l("br"),v._v("\n本项目的处理方法。打开页面，但是未输入密码时候，密码类型为text。输入之后，再将类型修改为password")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("ios返回时候不会刷新页面")])]),v._v(" "),l("p",[v._v("在业主的微信环境下。用户切换到其他页面之后，再返回回来。会导致页面莫名有些功能不可使用。本项目处理方式为。每次返回，重新loading页面。"),l("br"),v._v("\n监听popstate。在离开页面时候设置标志位。返回回来之后调用reload")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("文本长度超出容器滚动")])]),v._v(" "),l("p",[v._v("设计滚动组件内，文本不换行 "),l("br")]),v._v(" "),l("p",[v._v("mounted之后判断内部是否超过外部宽度，然后根据宽度设置动画时间 "),l("br")]),v._v(" "),l("p",[v._v("使用animation配合transform来拿完成滚动效果")])]),v._v(" "),l("li",[l("p",[l("strong",[v._v("textarea中部分内容不可编辑")])]),v._v(" "),l("p",[v._v('使用contenteditable="true"模拟一个textarea'),l("br")]),v._v(" "),l("p",[v._v('将其中不可编辑的内容单独写一个span 设置contenteditable="false"'),l("br")]),v._v(" "),l("p",[v._v("监听文本内容，整体文本设置一个正则，如果发现不可修改的位置被删除，那么返回上一次修改内容。")])])])])}),[],!1,null,null,null);_.default=t.exports}}]);